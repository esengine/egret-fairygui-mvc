window.mvc={},window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();var BaseView=function(t){function e(e){var n=t.call(this)||this;return n.viewLayer=viewLayer.pop,n._isDispose=!1,e&&(n.name=e),n}return __extends(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),e.prototype.init=function(){this._destoryChildren=!0},e.prototype.resize=function(){this._fuiView&&this._isShow&&(this._fuiView.width=LayerManager.getInstance().stage.stageWidth,this._fuiView.height=LayerManager.getInstance().stage.stageHeight)},e.prototype.baseShow=function(t){this._isShow=!0,this._showData=t,egret.callLater(this.resize,this)},e.prototype.show=function(){},e.prototype.close=function(){this._isShow=!1,ViewManager.getInstance().closeView(this)},e.prototype.baseRefresh=function(t){this._showData=t},e.prototype.refresh=function(t){this._showData=t},e.prototype.destroy=function(){if(this._isDispose=!0,this.parent&&this.parent.removeChild(this),this._destoryChildren){for(this._fuiView=null;this.numChildren>0;)this.removeChildAt(0);this._destoryChildren=!1}},e}(egret.DisplayObjectContainer),EventManager=function(){function t(){this._dict={},this._eventList=[]}return t.getInstance=function(){return this._single||(this._single=new t),this._single},t.prototype.addListener=function(t,e,n){var r=this._dict[t];null==r&&(r=[],this._dict[t]=r);var i,o=r.length;for(i=0;i<o;i++)if(r[i][0]==e&&r[i][1]==n)return;r.push([e,n])},t.prototype.removeListener=function(t,e,n){var r=this._dict[t];if(null!=r){var i,o=Array.length;for(i=0;i<o;i++)if(r[i][0]==e&&r[i][1]==n){r.splice(i,1),i--;break}0==r.length&&(delete this._dict[t],this._dict[t]=null)}},t.prototype.dispatch=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(null!=this._dict[t]){var r=new EventVo;r.type=t,r.param=e,this.dealMsg(r)}},t.prototype.dealMsg=function(t){var e=this._dict[t.type];if(e&&e.length>0)for(var n=0,r=e.length,i=null;n<r;)(i=e[n])[0].apply(i[1],t.param),e.length!=r&&(r=e.length,n--),n++;t.dispose()},t}(),EventVo=function(){function t(){}return t.prototype.dispose=function(){this.type=null,this.param=null},t}();String.prototype.trimStart=function(t){return function(t,e){var n;return n=e?new RegExp("^"+e):new RegExp(/^\s*/),t.replace(n,"")}(this,t)},String.prototype.trimEnd=function(t){return function(t,e){var n;return n=e?new RegExp(e+"$"):new RegExp(/\s*$/),t.replace(n,"")}(this,t)},Array.prototype.findIndex=function(t){return function(t,e){for(var n=0,r=t.length;n<r;n++)if(e.call(arguments[2],t[n],n,t))return n;return-1}(this,t)},Array.prototype.any=function(t){return function(t,e){return t.findIndex(e)>-1}(this,t)},Array.prototype.firstOrDefault=function(t){return function(t,e){var n=t.findIndex(e);return-1==n?null:t[n]}(this,t)},Array.prototype.find=function(t){return function(t,e){return t.firstOrDefault(e)}(this,t)},Array.prototype.where=function(t){return function(t,e){if("function"==typeof t.reduce)return t.reduce(function(n,r,i){return e.call(arguments[2],r,i,t)&&n.push(r),n},[]);for(var n=[],r=0,i=t.length;r<i;r++){var o=t[r];e.call(arguments[2],o,r,t)&&n.push(o)}return n}(this,t)},Array.prototype.count=function(t){return function(t,e){return t.where(e).length}(this,t)},Array.prototype.findAll=function(t){return function(t,e){return t.where(e)}(this,t)},Array.prototype.contains=function(t){return function(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof egret.DisplayObject&&e instanceof egret.DisplayObject){var i=e;if(t[n].hashCode==i.hashCode)return!0}else if(JSON.stringify(t[n])==JSON.stringify(e))return!0;return!1}(this,t)},Array.prototype.removeAll=function(t){!function(t,e){var n;do{(n=t.findIndex(e))>=0&&t.splice(n,1)}while(n>=0)}(this,t)},Array.prototype.remove=function(t){return function(t,e){var n=t.findIndex(function(t){return t===e});return n>=0&&(t.splice(n,1),!0)}(this,t)},Array.prototype.removeAt=function(t){return function(t,e){t.splice(e,1)}(this,t)},Array.prototype.removeRange=function(t,e){return function(t,e,n){t.splice(e,n)}(this,t,e)},Array.prototype.select=function(t){return function(t,e){if("function"==typeof t.reduce)return t.reduce(function(n,r,i){return n.push(e.call(arguments[2],r,i,t)),n},[]);for(var n=[],r=0,i=t.length;r<i;r++)n.push(e.call(arguments[2],t[r],r,t));return n}(this,t)},Array.prototype.orderBy=function(t,e){return function(t,e,n){return t.sort(function(t,r){var i=e(t),o=e(r);return n?n(i,o):i>o?1:-1}),t}(this,t,e)},Array.prototype.orderByDescending=function(t,e){return function(t,e,n){return t.sort(function(t,r){var i=e(t),o=e(r);return n?-n(i,o):i<o?1:-1}),t}(this,t,e)},Array.prototype.groupBy=function(t){return function(t,e){if("function"==typeof t.reduce){var n=[];return t.reduce(function(r,i,o){var s=JSON.stringify(e.call(arguments[1],i,o,t)),u=n.findIndex(function(t){return t===s});return u<0&&(u=n.push(s)-1),r[u]||(r[u]=[]),r[u].push(i),r},[])}for(var r=[],i=[],o=function(n,o){var u=JSON.stringify(e.call(s[1],t[n],n,t)),a=i.findIndex(function(t){return t===u});a<0&&(a=i.push(u)-1),r[a]||(r[a]=[]),r[a].push(t[n])},s=arguments,u=0,a=t.length;u<a;u++)o(u);return r}(this,t)},Array.prototype.sum=function(t){return function(t,e){for(var n,r=0,i=t.length;r<i;r++)0==r?n=e?e.call(arguments[2],t[r],r,t):t[r]:n+=e?e.call(arguments[2],t[r],r,t):t[r];return n}(this,t)};var viewLayer,FguiUtils=function(){function t(){}return t.load=function(t){var e=this;return new Promise(function(n,r){fairygui.UIPackage.getByName(t)&&n(),RES.loadGroup(t,0).then(function(){fairygui.UIPackage.addPackage(t),e.packageNamespace[t][t+"Binder"]&&e.packageNamespace[t][t+"Binder"].bindAll(),n()}).catch(function(t){console.error("loadfgui error:"+t),r()})})},t}();!function(t){t[t.pop=0]="pop"}(viewLayer||(viewLayer={}));var LayerManager=function(){function t(){}return t.getInstance=function(){return this._single||(this._single=new t),this._single},Object.defineProperty(t.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),t.prototype.init=function(t){this._stage=t,this.popLayer=new egret.DisplayObjectContainer,this._stage.addChild(this.popLayer)},t.prototype.addLayerToView=function(t){this[viewLayer[t.viewLayer]+"Layer"].addChild(t)},t}(),ViewManager=function(){function t(){this._openDic=[],this._skipCloseDic=[],this._layerManager=LayerManager.getInstance()}return t.getInstance=function(){return this._single||(this._single=new t),this._single},t.prototype.openView=function(t,e){var n=this;return new Promise(function(r,i){var o=n.getView(t);o||(o=new t),n.isOpenView(t)?o.refresh(e):(n._openDic.push(o),FguiUtils.load(o.name).then(function(){o.init(),o.baseShow(e),o.show(),n._layerManager.addLayerToView(o),r()}).catch(function(){n._openDic.remove(o),o.destroy(),o=null,i()}))})},t.prototype.closeView=function(t){var e=this._openDic.firstOrDefault(function(e){return e==t});e&&(this._openDic.remove(e),e.destroy(),e=null)},t.prototype.closeAll=function(){for(var t=0;t<this._openDic.length;t++){for(var e=this._openDic[t],n=!0,r=0;r<this._skipCloseDic.length;r++)e==this.getView(this._skipCloseDic[r])&&(n=!1);n&&(this.closeView(e),t--)}},t.prototype.closeViewByCls=function(t){var e=this._openDic.firstOrDefault(function(e){return e instanceof t});e&&(this._openDic.remove(e),e.destroy(),e=null)},t.prototype.getView=function(t){return this._openDic.firstOrDefault(function(e){return e instanceof t})},t.prototype.isOpenView=function(t){return-1!=this._openDic.findIndex(function(e){return e instanceof t})},t}();